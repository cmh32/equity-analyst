Equity Analyst Agent System
Final Project Report
Course: LLMs and Generative AI
Date: December 9, 2025

================================================================================
1. PURPOSE AND UTILITY
================================================================================

Purpose:
The goal of this project is to automate the labor-intensive process of institutional equity research. Traditional financial analysis requires synthesizing vast amounts of dataâ€”SEC filings (10-Ks), macroeconomic news, real-time stock prices, and historical financial statements. A single LLM prompt often fails to capture this complexity, leading to hallucinations or superficial summaries.

This project implements a "Manager-Agent" architecture that simulates a full investment firm. Instead of a single model generating an answer, a team of specialized AI agents (Macro, Quant, Technical, Fundamental) perform distinct research tasks. Crucially, a "Manager Agent" oversees their work, critiquing outputs and sending them back for revision if they fail to meet quality standards (e.g., missing data, lack of specific citations).

Utility:
This tool has significant utility for investors, financial analysts, and researchers. By automating the data gathering and initial synthesis:
1.  It democratizes access to high-quality, multi-perspective financial research.
2.  It reduces the time required for preliminary due diligence from hours to minutes.
3.  It enforces rigor through the "Manager" critique loop, ensuring reports address specific risks (e.g., interest rate sensitivity) that a generic chat interface might overlook.

================================================================================
2. DESIGN AND ARCHITECTURE
================================================================================

The system is built as a web application with a Python/FastAPI backend and a vanilla JavaScript frontend.

A. The AI Agent Architecture (The Core)
----------------------------------------
The system moves beyond a simple linear chain. It uses a "Hierarchical Worker-Manager" pattern implemented with the CrewAI framework and OpenAI's API.

1.  Specialized Agents:
    -   Macro & Sentiment Analyst: Uses web search to analyze PESTLE (Political, Economic, Social, Technological, Legal, Environmental) factors.
    -   Quantitative Analyst: Uses the `yfinance` API to pull real-time metrics and historical statements. It is strictly forbidden from making up numbers.
    -   Technical Analyst: Analyzes price action, moving averages (SMA), and RSI to determine entry points.
    -   Fundamental Strategist: Performs RAG (Retrieval Augmented Generation) on the company's 10-K filing to link financial numbers to qualitative risk factors.

2.  The Manager Agent (The Supervisor):
    -   Role: Acts as a quality gatekeeper. It does not generate content but evaluates it.
    -   Mechanism: After an agent completes a task, the Manager reviews the output against a strict checklist (e.g., "Did the Macro Analyst specifically mention tariff risks?").
    -   Revision Loop: If the output is rejected, the Manager provides specific "Revision Instructions." The agent must then revise its work. This loop repeats up to 2 times to ensure quality.

3.  Chief Investment Officer (CIO):
    -   Synthesizes the approved reports from all agents into a final Investment Memo with a recommendation (Buy/Sell/Hold), Conviction Score, and Kill Switch Price.

B. Search Augmented Retrieval (RAG)
-----------------------------------
The system employs RAG in two distinct ways:
1.  Analysis Phase: The Fundamental Strategist uses RAG to search the 10-K document for specific sections like "Risk Factors" and "Competition."
2.  Chat Phase: After the report is generated, the entire analysis is indexed into a vector database (ChromaDB). Users can then chat with the report (e.g., "Why did the CIO give a conviction score of 7?"), and the system retrieves the relevant sections from the specific agent's output.

C. Web Application
------------------
-   Backend: FastAPI handles the agent orchestration (`/analyze` endpoint) and chat functionality (`/chat` endpoint).
-   Frontend: A responsive web interface allows users to input a ticker, view the real-time progress of the agents, read the final markdown report, and interactively chat with the findings.

================================================================================
3. TECHNICAL ACCOMPLISHMENT
================================================================================

This project integrates approximately 5 significant technical features from the rubric:

1.  Sophisticated Agent Workflows (Manager-Critique Loop):
    Unlike standard linear chains, this project implements a dynamic feedback loop. The `src/managed_crew.py` and `src/manager_agent.py` modules implement a custom orchestration layer where an LLM (the Manager) programmatically evaluates the output of other LLMs and enforces revisions. This significantly reduces hallucinations and improves depth.

2.  Search Augmented Retrieval (RAG):
    The project uses `chromadb` to create ephemeral vector stores for every analysis run. This allows the system to ground its answers in the specific context of the generated report and the company's 10-K filing.

3.  Hosting as a Web Application:
    The project is not a notebook. It is a deployed application with a `FastAPI` server and a client-side UI, capable of handling long-running asynchronous agent tasks.

4.  Using Multiple APIs and Data Sources:
    -   OpenAI API (GPT-4o/GPT-5-nano) for reasoning.
    -   YFinance API for structured financial data.
    -   Serper/Google Search for real-time web information.
    -   SEC EDGAR (via custom scraper) for 10-K documents.

5.  Conversational Chat:
    The `/chat` endpoint allows users to interrogate the results. The system maintains conversation history and uses semantic search to find the exact paragraph in the 20+ page generated report that answers the user's question.

================================================================================
4. IMPLEMENTATION DETAILS & CODE QUALITY
================================================================================

Language: Python 3.10+
Key Libraries:
-   `crewai`: Agent framework.
-   `fastapi` / `uvicorn`: Web server.
-   `chromadb`: Vector database for RAG.
-   `yfinance`: Financial data.
-   `openai`: LLM interface.

Project Structure:
-   `src/managed_crew.py`: The main orchestration engine. Manages the ThreadPoolExecutor for parallel agent runs (Phase 1) and the sequential dependency for Phase 2 and 3.
-   `src/manager_agent.py`: Contains the logic for the "Manager," including the system prompts for critiquing different types of analysis.
-   `src/chat_service.py`: Handles the RAG implementation for the post-analysis chat.
-   `src/tools.py`: Wrappers for external tools (Web Search, Technical Analysis).

Correctness:
The system handles edge cases, such as missing 10-K data (falling back to pure quantitative analysis) or API failures (retrying or marking data as unavailable). The use of the "Manager" agent specifically targets the correctness of the *content*, filtering out generic or hallucinated responses before they reach the user.

================================================================================
5. CITATIONS AND ATTRIBUTIONS
================================================================================

Academic/Conceptual:
-   The "Manager-Worker" and "Critique-Revise" patterns are inspired by research into "Constitutional AI" and self-refining agents (e.g., Madaan et al., "Self-Refine: Iterative Refinement with Self-Feedback").

Software/Libraries:
-   CrewAI Framework: Used for structuring agent roles and tasks.
-   LangChain Community: Used for some underlying tool interfaces.
-   OpenAI API: Providers of the LLM models.
-   ChromaDB: Open-source embedding database.
-   YFinance: Open-source library for Yahoo Finance data.
-   FastAPI: Web framework.
